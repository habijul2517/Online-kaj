<!DOCTYPE html>
<html lang="en">
<head>
  <title>Online inkam ğŸ’¸</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Telegram SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Monetag SDK -->
      <script src='//libtl.com/sdk.js' data-zone='9615707' data-sdk='show_9615707'></script>

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: white;
      padding: 15px;
    }
    .container {
      max-width: 500px;
      margin: auto;
    }
    .card {
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    h2, h3 {
      margin-top: 0;
    }
    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      background: #00e676;
      color: #000;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }
    .btn-blue {
      background: #448aff;
      color: white;
    }
    .btn-orange {
      background: #ff9100;
      color: white;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: none;
      font-size: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h2>ğŸ‘‹ Welcome <span id="userId">User</span></h2>
      <p>ğŸ’° Balance: <span id="balance">0.00</span> à§³</p>
    </div>

    <div class="card">
      <h3>ğŸ¬ Watch Ad & Earn</h3>
      <p>â¤ 0.25à§³ per ad (16s), every 9th ad requires 2 minutes</p>
      <p>â¤ 20 ads every 40 minutes</p>
      <button class="btn" onclick="watchAd()">â–¶ï¸ Watch Ad</button>
    </div>

    <div class="card">
      <h3>ğŸŒ Visit Site & Earn</h3>
      <p>â¤ 0.5à§³ per visit (1 minute)</p>
      <button class="btn-blue" onclick="visitWebsite()">ğŸŒ Visit Website</button>
    </div>

    <div class="card">
      <h3>ğŸ“¤ Withdraw</h3>
      <p>Minimum 300à§³ required</p>
      <input type="number" id="withdrawAmount" placeholder="Amount to withdraw" />
      <select id="method">
        <option value="Bkash">Bkash</option>
        <option value="Nagad">Nagad</option>
      </select>
      <input type="text" id="wdNumber" placeholder="Your Bkash/Nagad Number" />
      <button class="btn-orange" onclick="requestWithdraw()">ğŸš€ Request Withdraw</button>
    </div>

    <div class="card">
      <h3>ğŸ”— Your Referral Link à¦ªà§à¦°à¦¤à¦¿ à¦°à§‡à¦«à¦¾à¦° à§§à§¦à¦Ÿà¦¾à¦•à¦¾</h3>
      <input type="text" id="refLink" readonly />
      <button class="btn-blue" onclick="copyRef()">ğŸ“‹ Copy Referral Link</button>
    </div>

    <div class="card">
      <h3>ğŸ“Š Stats</h3>
      <p>ğŸ¯ Ads Watched Today: <span id="adsToday">0</span></p>
      <p>ğŸ‘¥ Referral Commission: <span id="refCommission">0.00</span> à§³</p>
      <p>ğŸŒ Total Ads Watched: <span id="totalAds">0</span></p>
      <button class="btn-blue" onclick="showDetails()">ğŸ“– Show Details</button>
    </div>
  </div>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src='//libtl.com/sdk.js' data-zone='9615707' data-sdk='show_9615707'></script>

<script>
  const $ = id => document.getElementById(id);
  const tg = window.Telegram.WebApp;
  const userId = tg.initDataUnsafe?.user?.id?.toString() || "guest";
  $("userId").innerText = userId;

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyABPV6Ilx9G-5YLp5bk6YLyJ8uVcLm8fus",
    authDomain: "azbot-a5066.firebaseapp.com",
    databaseURL: "https://azbot-a5066-default-rtdb.firebaseio.com",
    projectId: "azbot-a5066",
    appId: "1:850012640650:android:5e19afd1a14f9c00392473"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const userRef = db.ref("users/" + userId);

  const today = new Date().toISOString().split("T")[0];
  const REWARDS = { ad: 0.25, ref: 10.025, visit: 0.15 };
  const LIMITS = { session: 20, cooldownMs: 40 * 60 * 1000 };
  const referrerId = new URLSearchParams(window.location.search).get("ref");

  let userData = {
    balance: 0,
    refCommission: 0,
    adsWatchedToday: 0,
    totalAds: 0,
    cooldownUntil: 0,
    lastAdDate: today
  };

  // Initial load from Firebase
  userRef.once("value").then(snapshot => {
    if (snapshot.exists()) {
      const data = snapshot.val();
      userData = { ...userData, ...data };

      // Reset ad count if new day
      if (userData.lastAdDate !== today) {
        userData.adsWatchedToday = 0;
        userData.cooldownUntil = 0;
        userData.lastAdDate = today;
        userRef.update({
          adsWatchedToday: 0,
          cooldownUntil: 0,
          lastAdDate: today
        });
      }
    } else {
      userRef.set(userData);
    }

    updateUI();
  });

  function updateUI() {
    $("balance").innerText = userData.balance.toFixed(2);
    $("adsToday").innerText = userData.adsWatchedToday;
    $("refCommission").innerText = userData.refCommission.toFixed(2);
    $("totalAds").innerText = userData.totalAds;
    $("refLink").value = `https://t.me/Onlinekaj214bot?start=${userId}`;
  }

  function watchAd() {
    const now = Date.now();

    if (userData.cooldownUntil && now < userData.cooldownUntil) {
      const minsLeft = Math.ceil((userData.cooldownUntil - now) / 60000);
      return alert(`â³ Please wait ${minsLeft} minutes before next session.`);
    }

    if (typeof show_9615707 !== "function") {
      return alert("âš ï¸ Ad not loaded yet.");
    }

    if (userData.adsWatchedToday && userData.adsWatchedToday % LIMITS.session === 0) {
      userData.cooldownUntil = now + LIMITS.cooldownMs;
      userRef.update({ cooldownUntil: userData.cooldownUntil });
      return alert("ğŸ” Session ended. Wait 41 minutes.");
    }

    show_9615707();

    const isLongAd = userData.adsWatchedToday % 9 === 8;
    const delay = isLongAd ? 45000 : 16000;
    if (isLongAd) alert("â³ Please watch this ad for 0.45 minutes.");

    setTimeout(() => {
      userData.balance += REWARDS.ad;
      userData.adsWatchedToday++;
      userData.totalAds++;

      const updates = {
        balance: userData.balance,
        adsWatchedToday: userData.adsWatchedToday,
        totalAds: userData.totalAds
      };

      userRef.update(updates);
      updateUI();

      if (referrerId && referrerId !== userId) {
        const refUser = db.ref("users/" + referrerId);
        refUser.once("value").then(snap => {
          if (snap.exists()) {
            const refData = snap.val();
            const newRefBal = (refData.balance || 0) + REWARDS.ref;
            const newRefCom = (refData.refCommission || 0) + REWARDS.ref;
            refUser.update({
              balance: newRefBal,
              refCommission: newRefCom
            });
          }
        });
      }

      alert(`âœ… You earned 0.25à§³ (Ad ${userData.adsWatchedToday})`);
    }, delay);
  }

  function visitWebsite() {
    window.open("https://otieu.com/4/9578063", "_blank");
    setTimeout(() => {
      userData.balance += REWARDS.visit;
      userRef.update({ balance: userData.balance });
      updateUI();
      alert("âœ… You earned 0.5à§³ for visiting.");
    }, 60000);
  }
function requestWithdraw() {
Â  const amount = +$("withdrawAmount").value.trim();
Â  const number = $("wdNumber").value.trim();
Â  const method = $("method").value;

Â  if (!amount || amount < 110) return alert("âŒ Minimum withdraw is 110à§³");
Â  if (userData.balance < amount) return alert("âŒ Insufficient balance.");
Â  if (!number) return alert("âŒ Enter your number.");

Â  // ğŸ‘‰ à¦°à§‡à¦«à¦¾à¦°à§‡à¦² à¦¸à¦‚à¦–à§à¦¯à¦¾ à¦šà§‡à¦• à¦•à¦°à§‹
Â  db.ref("referrals/" + userId).once("value").then(refSnap => {
Â  Â  const refCount = refSnap.exists() ? Object.keys(refSnap.val()).length : 0;

Â  Â  if (refCount < 5) {
Â  Â  Â  return alert("âŒ You need at least 5 referrals to withdraw.");
Â  Â  }

Â  Â  // âœ… à¦°à§‡à¦«à¦¾à¦° à¦¸à¦‚à¦–à§à¦¯à¦¾ à¦ à¦¿à¦• à¦¥à¦¾à¦•à¦²à§‡ à¦‰à¦‡à¦¥à¦¡à§à¦°à§‹ à¦ªà§à¦°à¦¸à§‡à¦¸ à¦•à¦°à§‹
Â  Â  userData.balance -= amount;
Â  Â  userRef.update({ balance: userData.balance });
Â  Â  updateUI();

Â  Â  const withdrawRef = db.ref("withdraw_requests").push();
Â  Â  withdrawRef.set({
Â  Â  Â  userId,
Â  Â  Â  amount,
Â  Â  Â  method,
Â  Â  Â  number,
Â  Â  Â  timestamp: Date.now()
Â  Â  });

Â  Â  alert(`âœ… Withdraw request of ${amount}à§³ sent to ${method}: ${number}`);
Â  });
}

  

  function copyRef() {
    const input = $("refLink");
    input.select();
    input.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(input.value);
    alert("âœ… Referral link copied!");
  }

  function showDetails() {
    alert(`ğŸ“… Ads Today: ${userData.adsWatchedToday}\nğŸ‘¥ Referral Earnings: ${userData.refCommission.toFixed(2)} à§³\nğŸŒ Total Ads: ${userData.totalAds}`);
  }
</script>

</body>
</html>
